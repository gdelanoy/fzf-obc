#!/usr/bin/env bash
_filedir()
{
  local IFS=$'\n'

  __fzf_obc_tilde "${cur%%\**}" || return

  __fzf_add2compreply < <(__fzf_obc_search "${cur}" "dirs")

  if [[ "$1" != -d ]]; then
      local xspec=${1:+"*.@($1|${1^^})"};
      __fzf_add2compreply < <(__fzf_obc_search "${cur}" "files" "${xspec}")
      [[ -n ${COMP_FILEDIR_FALLBACK:-} && -n "$1" && ${#COMPREPLY[@]} -lt 1 ]] && __fzf_add2compreply < <(__fzf_obc_search "${cur}" "files")
  fi

  if [[ "${#COMPREPLY[@]}" -gt 0 ]];then
    compopt -o filenames
  fi

  return 0
}
